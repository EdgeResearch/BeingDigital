<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title th:text="${argomento.titolo}"></title>

    <!-- Link per Slick Carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" type="text/css"
          href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>
    <link rel="stylesheet" th:href="@{/stylesheet/argomento.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/stylesheet/flashcard.css}" type="text/css"/>
    <link href="/img/Logo.png" rel="shortcut icon"/>
</head>

<body>

<th:block th:include="fragments/header"></th:block>

<div class="racconto">
    <section class="bannerRacconto" th:style="'background: linear-gradient(rgba(0, 0, 0, 0.5), #282828c4), url('+@{/copertina(idArgomento=${param.id})}+'); background-size: cover; background-position: center;'">
        <div class="banner-text">
            <h1 th:text="${argomento.titolo}"></h1>
        </div>
    </section>

    <!-- caso in cui l'argomento è un racconto -->
    <div th:if="${argomento.id == 500}">
        <iframe th:replace="presentazionerisorse/racconto :: racconto"></iframe>
    </div>

    <div th:if="${argomento.id != 500}" class="raccontoText">
        <h2> Lezione </h2>

        <div id="argomentoContent" th:utext="${argomento.corpo}" style="display: none;"></div>
        <!-- Contenitore per le card -->
        <div class="card-container" id="cardContainer">
            <!-- Le card verranno inserite qui dinamicamente -->
        </div>

        <h2> Esempi </h2>

        <h2> Flash Cards </h2>

        <div class="iframe-row">
            <iframe th:replace="presentazionerisorse/flashcard :: flashcardContent"></iframe>
        </div>
        <!-- <svg width="1000" height="1000"></svg> -->

        <!-- Contenitore per la mappa -->
        <h2> Mappa concettuale </h2>
        <div id="diagram" style="position: relative">
            <div id="myDiagramDiv"
                 style="background-color: #f2f2f2; border: solid 1px black; width: 100%; height: 500px"></div>
            <div id="myOverviewDiv"></div>
        </div>


        <div class="box-bottoni">
            <a class="btnUtente" th:if="${lastId != null}" th:href="@{/argomento(id=${lastId})}">Lezione precedente</a>
            <a class="btnUtente" href="/utente/lezioniPrivacy">Lista Lezioni</a>
            <a class="btnUtente" th:if="${nextId != null}" th:href="@{/argomento(id=${nextId})}">Lezione successiva</a>
        </div>
    </div>

</div>


<th:block th:include="fragments/footer"></th:block>
</body>

<!-- Includi lo script lezione_passwordsicura.js -->
<script src="https://unpkg.com/gojs/release/go-debug.js"></script>
<script src="https://d3js.org/d3.v6.min.js"></script>
<script th:src="@{/js/mappe/privacy/base/lezione_passwordsicura.js}"></script>

<!-- Caricamento dinamico del file JS della mappa -->
<!-- <script th:src="@{${argomento.mappa}}"></script> -->

<!-- Includi Slick Carousel -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

<script>
    // Funzione che crea le card dividendo il testo in base al <p>
    function generateCards() {
        const content = document.getElementById('argomentoContent').innerHTML;
        const parser = new DOMParser();
        const doc = parser.parseFromString(content, 'text/html');

        // Seleziona tutti i tag <p>
        const sections = doc.querySelectorAll('p');

        const cardContainer = document.getElementById('cardContainer');

        let cardIndex = 0;

        sections.forEach((section) => {
            // Ottieni il contenuto del paragrafo
            const sectionContent = section.innerHTML.trim();

            // Ignora i paragrafi che contengono solo "&nbsp;" o sono vuoti
            if (sectionContent === "&nbsp;" || sectionContent === "") {
                return; // Salta questo ciclo e non crea la card
            }

            // Crea una nuova card
            const card = document.createElement('div');
            card.classList.add('card');

            // Crea il titolo della card
            const titlecard = document.createElement('h2');
            titlecard.textContent = `0${++cardIndex}`;

            // Crea il paragrafo della card
            const paragraph = document.createElement('p');
            paragraph.innerHTML = sectionContent;

            // Aggiunge titolo, paragrafo e bottone alla card
            card.appendChild(titlecard);
            card.appendChild(paragraph);

            // Aggiunge la card al container
            cardContainer.appendChild(card);
        });

        // Inizializza il carosello Slick
        $('.card-container').slick({
            slidesToShow: 1,  // Mostra una card alla volta
            slidesToScroll: 1,
            dots: true,       // Aggiunge i puntini di navigazione
            infinite: false,  // Disabilita lo scorrimento infinito
            prevArrow: '<button type="button" class="slick-prev">Previous</button>',
            nextArrow: '<button type="button" class="slick-next">Next</button>'
        });
    }

    // Chiama la funzione quando la pagina è caricata
    window.onload = generateCards;
</script>


</html>